<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Inventarisasi Aset LMAN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        #app-wrapper {
            position: relative;
            height: 100%;
            width: 100%;
        }
        #app-container {
            height: 100%;
            width: 100%;
        }
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .screen, .page, .page-content {
            animation: fadeIn 0.4s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .otp-input {
            width: 3rem; height: 3.5rem; text-align: center; font-size: 1.5rem;
            border-radius: 0.5rem; border: 1px solid #D1D5DB; transition: all 0.2s;
        }
        .otp-input:focus {
            border-color: #2563EB;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
            outline: none;
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .nav-link.active { background-color: #3b82f6; color: white; }
    </style>
</head>
<body class="bg-gray-100">

    <div id="app-wrapper">
        <!-- Tombol Fullscreen ditambahkan di sini -->
        <button id="fullscreen-btn" style="position: fixed; top: 1rem; right: 1rem; z-index: 9999;" class="bg-gray-800 text-white p-2 rounded-full shadow-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1v4m0 0h-4m4 0l-5-5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 0h-4m4 0l-5 5" />
            </svg>
        </button>

        <div id="app-container">
            <!-- Konten Aplikasi akan dirender oleh JavaScript di sini -->
        </div>
    </div>

    <script>
    // --- FUNGSI FULLSCREEN ---
    const fullscreenBtn = document.getElementById('fullscreen-btn');
    const appWrapper = document.getElementById('app-wrapper');

    fullscreenBtn.addEventListener('click', () => {
        if (document.fullscreenElement) {
            document.exitFullscreen();
        } else {
            // Meminta fullscreen untuk elemen pembungkus, bukan seluruh dokumen
            appWrapper.requestFullscreen().catch(err => {
                alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
            });
        }
    });

    const App = {
        // --- DATABASE PENGGUNA (SIMULASI) ---
        users: {
            'admin@lman.go.id': { role: 'admin', name: 'Admin LMAN' },
            'user@lman.go.id': { role: 'user', name: 'Budi Santoso', assigned_roles: ['petugas', 'verifikator'] },
            'ani@lman.go.id': { role: 'user', name: 'Ani Wijaya', assigned_roles: ['petugas'] },
            'citra@lman.go.id': { role: 'user', name: 'Citra Lestari', assigned_roles: ['verifikator'] },
            'dodi@lman.go.id': { role: 'user', name: 'Dodi Firmansyah', assigned_roles: ['petugas'] }
        },

        // --- STATE APLIKASI ---
        state: {
            currentPage: 'login',
            currentUser: null,
            activeUserRole: null, // Untuk menyimpan peran yang dipilih user
            loginIdentifier: '',
            petugas: {
                kertasKerja: [
                    { 
                        id: 'KK-001', 
                        batch: 'Inv. Limbah - Agustus 2025', 
                        totalAset: 150, 
                        progres: 2, 
                        status: 'Berlangsung',
                        assets: [
                            { id: 'LBH-0451', desc: 'BEAM - 250 MM X 125 MM', location: 'Area Limbah', status: 'Selesai' },
                            { id: 'LBH-0452', desc: 'PIPA - BESI 6 INCH', location: 'Area Limbah', status: 'Selesai' },
                            { id: 'LBH-0453', desc: 'DRUM - BEKAS OLI', location: 'Area Limbah', status: 'Belum Diperiksa' },
                        ]
                    },
                    { 
                        id: 'KK-002', 
                        batch: 'Inv. Gudang A - Juli 2025', 
                        totalAset: 1, 
                        progres: 0, 
                        status: 'Perlu Penelitian Ulang', 
                        catatan: 'Foto tidak jelas.',
                        assets: [
                            { id: 'VLV-1001', desc: 'VALVE BUTTERFLY, 16IN', location: 'Gudang A', status: 'Perlu Diperiksa Ulang' }
                        ]
                    }
                ],
                currentKertasKerjaId: null,
                currentAsset: null,
            },
            verifikator: {
                currentItem: null,
                verificationList: [
                    { 
                        id: 'LMAN-VLV-1001', 
                        materialCode: '5200036051', 
                        desc: 'VALVE BUTTERFLY, 16IN, 150LB', 
                        submittedBy: 'Budi Santoso', 
                        date: '25/07/2025 10:30', 
                        batch: 'Inv. Gudang A - Juli 2025',
                        status: 'Menunggu Verifikasi', 
                        photos: ['https://placehold.co/600x400/cccccc/666666?text=Foto+Valve+1', 'https://placehold.co/600x400/cccccc/666666?text=Foto+Valve+2'], 
                        details: { 
                            klasifikasi: 'Metal', 
                            kondisi: 'Baik', 
                            tonase: '50', 
                            dimensi: '40x40x30 cm',
                            expiredDate: '2030-12-31',
                            assetGroup: '2. Piping System',
                            keterangan: 'Ditemukan di rak bagian atas.',
                            lokasi: 'Gudang A / AN-FL-01/C'
                        }, 
                        previousData: { 
                            qtyTotal: 2, 
                            lokasi: {'AN-FL-01/C': 1, 'AN-FL-02/A': 1}
                        }
                    },
                    { 
                        id: 'LMAN-LBH-0451', 
                        materialCode: '5200036817', 
                        desc: 'BEAM - 250 MM X 125 MM X 6', 
                        submittedBy: 'Ani Wijaya', 
                        date: '25/07/2025 09:10', 
                        batch: 'Inv. Limbah - Agustus 2025',
                        status: 'Menunggu Verifikasi', 
                        photos: ['https://placehold.co/600x400/cccccc/666666?text=Foto+BEAM'], 
                        details: { 
                            klasifikasi: 'Metal', 
                            kondisi: 'Rusak Berat', 
                            tonase: '1200', 
                            dimensi: '',
                            expiredDate: '',
                            assetGroup: '',
                            keterangan: 'Korosi parah di beberapa bagian.',
                            lokasi: 'Area Limbah / Blok C'
                        }, 
                        previousData: { 
                            qtyTotal: 1, 
                            lokasi: {'YD-SHELTER': 1}
                        }
                    },
                     { 
                        id: 'LMAN-NEW-001', 
                        materialCode: '', 
                        desc: 'COMPRESSOR ANGIN BEKAS', 
                        submittedBy: 'Budi Santoso', 
                        date: '26/07/2025 11:00', 
                        batch: 'Inv. Gudang A - Juli 2025',
                        status: 'Menunggu Verifikasi', 
                        photos: ['https://placehold.co/600x400/cccccc/666666?text=Foto+Compressor'], 
                        details: { 
                            klasifikasi: 'Metal', 
                            kondisi: 'Rusak Ringan', 
                            tonase: '250', 
                            dimensi: '120x80x100 cm',
                            expiredDate: '',
                            assetGroup: '1. Process Equipment, and Mechanical System',
                            keterangan: 'Aset temuan baru, tidak ada di master data.',
                            lokasi: 'Gudang A / Pojok Belakang'
                        }, 
                        previousData: null
                    },
                ]
            }
        },

        // --- TEMPLATE UNTUK SETIAP HALAMAN/PERAN ---
        templates: {
            login(state) {
                return `
                <div class="page flex items-center justify-center min-h-screen">
                    <div class="w-full p-4">
                        <div class="bg-white rounded-xl shadow-lg p-8 max-w-md mx-auto">
                            <div class="text-center mb-8">
                                <div class="inline-block bg-gray-200 p-3 rounded-full mb-4">
                                    <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                                </div>
                                <h1 class="text-2xl font-bold text-gray-800">Sistem Inventarisasi Aset</h1>
                                <p class="text-gray-500">Lembaga Manajemen Aset Negara</p>
                            </div>
                            <div id="form-container">
                                <form id="request-otp-form" class="space-y-6">
                                    <div>
                                        <label for="identifier" class="text-sm font-medium text-gray-700">Email</label>
                                        <input type="text" id="identifier" name="identifier" class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm" placeholder="admin@lman.go.id" required>
                                        <p class="text-xs text-gray-500 mt-2">Coba: <strong>admin@lman.go.id</strong> atau <strong>user@lman.go.id</strong></p>
                                    </div>
                                    <div><button type="submit" class="w-full flex justify-center py-3 px-4 rounded-lg font-medium text-white bg-blue-600 hover:bg-blue-700">Login</button></div>
                                    <p id="login-error" class="text-red-500 text-sm text-center hidden">Pengguna tidak ditemukan.</p>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>`;
            },
            
            admin(state) {
                return `
                <div class="page flex h-screen bg-gray-100">
                    <aside class="w-64 flex-shrink-0 bg-gray-800 text-gray-300 flex flex-col">
                        <div class="h-20 flex items-center justify-center bg-gray-900"><div class="flex items-center space-x-3"><div class="bg-blue-500 p-2 rounded-lg"><svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><span class="text-white text-xl font-bold">Admin Panel</span></div></div>
                        <nav class="flex-1 px-4 py-6 space-y-2">
                            <a href="#dashboard" class="nav-link flex items-center px-4 py-2.5 rounded-lg"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>Dashboard</a>
                            
                            <p class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-400 uppercase">Data Master</p>
                            <a href="#master-mi" class="nav-link flex items-center px-4 py-2.5 rounded-lg"><svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" /></svg>Master MI</a>
                            <a href="#katalog-mi" class="nav-link flex items-center px-4 py-2.5 rounded-lg"><svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>Katalog MI</a>
                            
                            <p class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-400 uppercase">Operasional</p>
                            <a href="#kegiatan" class="nav-link flex items-center px-4 py-2.5 rounded-lg"><svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" /></svg>Kegiatan & Batch</a>
                            <a href="#users" class="nav-link flex items-center px-4 py-2.5 rounded-lg"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197m0 0A5.97 5.97 0 0112 13a5.97 5.97 0 01-3-1.197z"></path></svg>Manajemen User</a>
                            <a href="#locations" class="nav-link flex items-center px-4 py-2.5 rounded-lg"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>Manajemen Lokasi</a>
                            <a href="#reports" class="nav-link flex items-center px-4 py-2.5 rounded-lg"><svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 3H21V5H3V3ZM3 19H21V21H3V19ZM3 11H21V13H3V11Z"/></svg>Laporan</a>
                        </nav>
                        <div class="px-4 py-4 border-t border-gray-700"><button data-action="logout" class="w-full flex items-center px-4 py-2.5 rounded-lg text-red-400 hover:bg-red-500 hover:text-white"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>Logout</button></div>
                    </aside>
                    <div class="flex-1 flex flex-col overflow-hidden">
                        <header class="h-20 flex justify-between items-center px-8 bg-white border-b"><h1 id="page-title" class="text-2xl font-bold text-gray-800"></h1><div class="flex items-center space-x-4"><span class="text-gray-600">Selamat datang, <span class="font-semibold">${state.currentUser.name}</span></span><img class="w-10 h-10 rounded-full object-cover" src="https://placehold.co/100x100/E2E8F0/4A5568?text=A" alt="Avatar Admin"></div></header>
                        <main id="admin-main-content" class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-8"></main>
                    </div>
                </div>`;
            },
            
            user(state) {
                return `<div id="user-page-container" class="page"></div>`;
            },
        },

        init() { this.renderPage(); this.attachEventListeners(); },
        renderPage() {
            document.getElementById('app-container').innerHTML = this.templates[this.state.currentPage](this.state);
            this.postRender();
        },
        postRender() {
            const page = this.state.currentPage;
            if (page === 'admin') this.admin.init();
            if (page === 'user') this.user.init();
        },
        attachEventListeners() {
            const container = document.getElementById('app-container');
            container.addEventListener('click', (e) => {
                const actionTarget = e.target.closest('[data-action]');
                if (actionTarget && actionTarget.dataset.action === 'logout') {
                    window.location.hash = '';
                    this.state.currentUser = null; this.state.currentPage = 'login';
                    this.renderPage();
                }
            });
            container.addEventListener('submit', (e) => {
                if (e.target.id === 'request-otp-form') {
                    e.preventDefault();
                    const identifier = e.target.identifier.value.trim().toLowerCase();
                    if (this.users[identifier]) {
                        this.state.currentUser = { ...this.users[identifier], identifier };
                        this.state.currentPage = this.users[identifier].role;
                        this.renderPage();
                    } else { document.getElementById('login-error').classList.remove('hidden'); }
                }
            });
        },
        
        admin: {
            // --- DATA SIMULASI UNTUK ADMIN ---
            masterAsetData: [
                { code: '5200007420', desc: 'VALVE-SAFETY,TYPE: NS255DB,1.5 IN 300', qty: 1, unit: 'EA', location: 'AN PH-10' },
                { code: '5200036051', desc: 'VALVE BUTTERFLY, 16IN, 150LB', qty: 2, unit: 'EA', location: 'AN-FL-01/C' },
                { code: '5200035623', desc: 'VALVE - GATE, 8IN, 150LB, EXTEN.STEM', qty: 1, unit: 'EA', location: 'AN-FL-02/A' },
                { code: '5200036817', desc: 'BEAM - 250 MM X 125 MM X 6', qty: 1, unit: 'EA', location: 'YD-SHELTER' },
                { code: '5200036825', desc: 'PLATE - STEEL,1/8IN X 4 X 8 FT, MATL CS', qty: 0, unit: 'EA', location: 'YD-SHELTER' }
            ],

            init() { this.renderContent(window.location.hash || '#dashboard'); this.attachAdminListeners(); },
            renderContent(hash) {
                const container = document.getElementById('admin-main-content');
                const title = document.getElementById('page-title');
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                let activeLink = document.querySelector(`.nav-link[href="${hash}"]`) || document.querySelector('.nav-link[href="#dashboard"]');
                activeLink.classList.add('active');
                let pageId = hash.substring(1).split('?')[0];
                if (this.contentTemplates[pageId]) {
                    title.textContent = this.pageTitles[pageId] || activeLink.textContent.trim();
                    container.innerHTML = this.contentTemplates[pageId](App.state);
                } else {
                    title.textContent = "Dashboard"; container.innerHTML = this.contentTemplates.dashboard(App.state);
                }
            },
            attachAdminListeners() {
                document.body.addEventListener('click', e => {
                    const navLink = e.target.closest('.nav-link, .action-link');
                    if (navLink) { e.preventDefault(); const hash = navLink.getAttribute('href'); window.location.hash = hash; this.renderContent(hash); }
                    
                    const actionTarget = e.target.closest('[data-action]');
                    if (actionTarget) {
                        const action = actionTarget.dataset.action;
                        if(action === 'open-kegiatan-modal' || action === 'open-batch-modal') {
                            document.getElementById(actionTarget.dataset.modal).classList.remove('hidden');
                        }
                        if(action === 'close-modal') {
                            actionTarget.closest('.modal-container').classList.add('hidden');
                        }
                    }
                });
                document.body.addEventListener('submit', e => {
                    if(e.target.id === 'form-kegiatan' || e.target.id === 'form-batch') {
                        e.preventDefault();
                        alert('Data baru berhasil disimpan!');
                        e.target.closest('.modal-container').classList.add('hidden');
                    }
                });
            },
            pageTitles: {
                'dashboard': 'Dashboard', 'master-mi': 'Manajemen Master MI', 'katalog-mi': 'Manajemen Katalog MI',
                'users': 'Manajemen User', 'locations': 'Manajemen Lokasi', 'kegiatan': 'Kegiatan & Batch', 'reports': 'Laporan',
            },
            contentTemplates: {
                dashboard: () => `<div class="page-content"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"><div class="bg-white border p-5 rounded-xl shadow-sm"><h3 class="font-semibold text-gray-500">Total Aset di Master</h3><p class="text-3xl font-bold text-gray-800">${App.admin.masterAsetData.length}</p></div><div class="bg-white border p-5 rounded-xl shadow-sm"><h3 class="font-semibold text-gray-500">Total Kegiatan</h3><p class="text-3xl font-bold text-yellow-600">1</p></div><div class="bg-white border p-5 rounded-xl shadow-sm"><h3 class="font-semibold text-gray-500">Total User Aktif</h3><p class="text-3xl font-bold text-blue-600">4</p></div><div class="bg-white border p-5 rounded-xl shadow-sm"><h3 class="font-semibold text-gray-500">Aset Belum Diverifikasi</h3><p class="text-3xl font-bold text-red-600">0</p></div></div></div>`,
                'master-mi': () => {
                    const tableRows = App.admin.masterAsetData.map(item => `
                        <tr class="bg-white border-b hover:bg-gray-50">
                            <td class="px-6 py-4 font-mono text-sm">${item.code}</td>
                            <td class="px-6 py-4">${item.desc}</td>
                            <td class="px-6 py-4 text-center">${item.qty}</td>
                            <td class="px-6 py-4 text-center">${item.unit}</td>
                            <td class="px-6 py-4">${item.location}</td>
                            <td class="px-6 py-4 flex space-x-2 justify-center">
                                <button class="text-blue-600 hover:text-blue-800" title="Edit"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L16.732 3.732z"></path></svg></button>
                                <button class="text-red-600 hover:text-red-800" title="Delete"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                            </td>
                        </tr>
                    `).join('');

                    return `<div class="page-content bg-white p-6 rounded-xl shadow-md"><div class="flex justify-between items-center mb-6"><h2 class="text-xl font-semibold text-gray-700">Manajemen Master MI</h2><div class="flex space-x-2"><button class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium flex items-center"><svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" /></svg>Import Data</button><button class="bg-green-600 text-white px-4 py-2 rounded-lg font-medium flex items-center"><svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>Tambah Aset</button></div></div><div class="overflow-x-auto"><table class="w-full text-sm text-left text-gray-500"><thead class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th class="px-6 py-3">Material Code</th><th class="px-6 py-3">Nama Aset</th><th class="px-6 py-3 text-center">Kuantitas</th><th class="px-6 py-3 text-center">Unit</th><th class="px-6 py-3">Lokasi</th><th class="px-6 py-3 text-center">Aksi</th></tr></thead><tbody>${tableRows}</tbody></table></div></div>`;
                },
                'katalog-mi': () => `<div class="page-content"><div class="flex justify-between items-center mb-6"><h2 class="text-xl font-semibold text-gray-700">Manajemen Katalog MI</h2><div class="flex space-x-2"><button class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium flex items-center"><svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" /></svg>Import Katalog</button><button class="bg-green-600 text-white px-4 py-2 rounded-lg font-medium flex items-center"><svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>Tambah Katalog</button></div></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><div class="bg-white rounded-lg shadow"><img src="https://placehold.co/400x300/e2e8f0/64748b?text=VALVE" alt="Katalog Aset" class="w-full h-40 object-cover rounded-t-md"><div class="p-4"><h3 class="font-semibold text-gray-800">VALVE BUTTERFLY, 16IN</h3><p class="text-sm text-gray-500">Spesifikasi: 150LB, W/GEAR, API 609</p></div><div class="p-4 border-t flex justify-end space-x-2"><button class="text-blue-600 hover:text-blue-800"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L16.732 3.732z"></path></svg></button><button class="text-red-600 hover:text-red-800"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div></div></div></div>`,
                users: () => `<div class="page-content bg-white p-6 rounded-xl shadow-md"><div class="flex justify-between items-center mb-6"><h2 class="text-xl font-semibold text-gray-700">Manajemen User</h2><button class="bg-green-600 text-white px-4 py-2 rounded-lg font-medium">Tambah User</button></div><div class="overflow-x-auto"><table class="w-full text-sm text-left"><thead class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th class="px-6 py-3">Nama</th><th class="px-6 py-3">Email</th><th class="px-6 py-3">Tipe Akun</th><th class="px-6 py-3">Status</th><th class="px-6 py-3 text-center">Aksi</th></tr></thead><tbody>
                ${Object.entries(App.users).map(([email, user]) => `
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <td class="px-6 py-4">${user.name}</td>
                        <td class="px-6 py-4">${email}</td>
                        <td class="px-6 py-4"><span class="text-xs px-2 py-1 rounded-full ${user.role === 'admin' ? 'bg-gray-200 text-gray-800' : 'bg-blue-200 text-blue-800'}">${user.role === 'admin' ? 'Admin' : 'User'}</span></td>
                        <td class="px-6 py-4 font-semibold ${user.status === 'Nonaktif' ? 'text-red-600' : 'text-green-600'}">${user.status || 'Aktif'}</td>
                        <td class="px-6 py-4 text-center">...</td>
                    </tr>
                `).join('')}
                </tbody></table></div></div>`,
                locations: () => `<div class="page-content"><div class="flex justify-between items-center mb-6"><h2 class="text-xl font-semibold text-gray-700">Manajemen Lokasi</h2><button class="bg-green-600 text-white px-4 py-2 rounded-lg font-medium">Tambah Lokasi</button></div><div class="grid grid-cols-1 lg:grid-cols-3 gap-8"><div class="bg-white p-6 rounded-xl shadow-md"><h3 class="font-semibold mb-4">Gedung / Area</h3><ul class="space-y-2"><li class="bg-gray-100 p-2 rounded">Gudang A</li><li class="bg-gray-100 p-2 rounded">Gudang B</li><li class="bg-gray-100 p-2 rounded">Area Terbuka</li></ul></div><div class="bg-white p-6 rounded-xl shadow-md"><h3 class="font-semibold mb-4">Storage Location</h3><ul class="space-y-2"><li class="bg-gray-100 p-2 rounded">AN-FL-01/C</li><li class="bg-gray-100 p-2 rounded">AN-FL-02/A</li><li class="bg-gray-100 p-2 rounded">YD-SHELTER</li></ul></div><div class="bg-white p-6 rounded-xl shadow-md"><h3 class="font-semibold mb-4">Storage Bin</h3><ul class="space-y-2"><li class="bg-gray-100 p-2 rounded">Rak 1</li><li class="bg-gray-100 p-2 rounded">Palet 12</li><li class="bg-gray-100 p-2 rounded">AN PH-10</li></ul></div></div></div>`,
                kegiatan: () => `<div class="page-content">
                    <div class="bg-white p-6 rounded-xl shadow-md mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold">Kegiatan Inventarisasi PHE 2025</h2>
                            <button data-action="open-kegiatan-modal" data-modal="kegiatan-modal" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium">Buat Kegiatan Baru</button>
                        </div>
                        <p class="text-gray-600">Periode: 01 Jan 2025 - 31 Des 2025</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Daftar Batch</h3>
                            <button data-action="open-batch-modal" data-modal="batch-modal" class="bg-green-600 text-white px-4 py-2 rounded-lg font-medium">Buat Batch Baru</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left"><thead class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th class="px-6 py-3">Nama Batch</th><th class="px-6 py-3">Periode</th><th class="px-6 py-3">Tim Pelaksana</th><th class="px-6 py-3">Verifikator</th><th class="px-6 py-3">Status</th><th class="px-6 py-3">Aksi</th></tr></thead><tbody><tr class="bg-white border-b"><td class="px-6 py-4">Batch 1: Gudang A & B</td><td class="px-6 py-4">01 Jul - 31 Jul</td><td class="px-6 py-4">Tim A, Tim C</td><td class="px-6 py-4">Citra Lestari</td><td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs px-2.5 py-0.5 rounded-full">Selesai</span></td><td class="px-6 py-4"><a href="#" class="text-blue-600 font-semibold">Detail</a></td></tr><tr class="bg-gray-50 border-b"><td class="px-6 py-4">Batch 2: Area Limbah</td><td class="px-6 py-4">01 Agu - 31 Agu</td><td class="px-6 py-4">Tim B</td><td class="px-6 py-4">Citra Lestari, Verifikator B</td><td class="px-6 py-4"><span class="bg-yellow-100 text-yellow-800 text-xs px-2.5 py-0.5 rounded-full">Berlangsung</span></td><td class="px-6 py-4"><a href="#" class="text-blue-600 font-semibold">Detail</a></td></tr></tbody></table>
                        </div>
                    </div>
                    <!-- Modal Tambah Kegiatan -->
                    <div id="kegiatan-modal" class="modal-container fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"><div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md"><h2 class="text-2xl font-bold mb-6">Buat Kegiatan Baru</h2><form id="form-kegiatan" class="space-y-4"><div><label for="nama_kegiatan" class="block text-sm font-medium text-gray-700">Nama Kegiatan</label><input type="text" id="nama_kegiatan" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required></div><div><label for="periode_kegiatan" class="block text-sm font-medium text-gray-700">Periode</label><input type="text" id="periode_kegiatan" placeholder="cth: 01 Jan 2026 - 31 Des 2026" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required></div><div><label for="deskripsi_kegiatan" class="block text-sm font-medium text-gray-700">Deskripsi</label><textarea id="deskripsi_kegiatan" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea></div><div class="flex justify-end space-x-4 pt-4"><button type="button" data-action="close-modal" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg">Batal</button><button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg">Simpan Kegiatan</button></div></form></div></div>
                    <!-- Modal Tambah Batch -->
                    <div id="batch-modal" class="modal-container fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"><div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-lg"><h2 class="text-2xl font-bold mb-6">Buat Batch Baru</h2><form id="form-batch" class="space-y-4"><div><label for="nama_batch" class="block text-sm font-medium text-gray-700">Nama Batch</label><input type="text" id="nama_batch" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required></div><div><label class="block text-sm font-medium text-gray-700">Tim Pelaksana (bisa lebih dari satu)</label><select multiple class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"><option>Tim A</option><option>Tim B</option><option>Tim C</option></select></div><div><label class="block text-sm font-medium text-gray-700">Verifikator (bisa lebih dari satu)</label><select multiple class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"><option>Citra Lestari</option><option>Verifikator B</option></select></div><div class="flex justify-end space-x-4 pt-4"><button type="button" data-action="close-modal" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg">Batal</button><button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg">Simpan Batch</button></div></form></div></div>
                </div>`,
                reports: () => `<div class="page-content bg-white p-6 rounded-xl shadow-md"><h2 class="text-xl font-semibold mb-2">Laporan Global</h2><p class="text-gray-600 mb-6">Rekapitulasi hasil inventarisasi dari semua batch yang telah selesai.</p><div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"><div class="bg-blue-50 p-4 rounded-lg"><h3 class="font-semibold text-blue-800">Total Selisih Nilai</h3><p class="text-2xl font-bold text-blue-600">Rp 15.250.000</p></div><div class="bg-green-50 p-4 rounded-lg"><h3 class="font-semibold text-green-800">Aset Baru Ditemukan</h3><p class="text-2xl font-bold text-green-600">12</p></div><div class="bg-red-50 p-4 rounded-lg"><h3 class="font-semibold text-red-800">Aset Tidak Ditemukan</h3><p class="text-2xl font-bold text-red-600">5</p></div></div><h3 class="text-lg font-semibold mb-4">Pilih Laporan Rinci</h3><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><a href="#" class="action-link block p-4 bg-gray-50 hover:bg-gray-100 rounded-lg">Laporan per Lokasi</a><a href="#" class="action-link block p-4 bg-gray-50 hover:bg-gray-100 rounded-lg">Laporan per Kondisi</a><a href="#" class="action-link block p-4 bg-gray-50 hover:bg-gray-100 rounded-lg">Laporan Aset Berlebih</a></div></div>`,
            }
        },
        user: {
            init() { this.renderScreen('roleSelection'); this.attachListeners(); },
            renderScreen(screenName) {
                document.getElementById('user-page-container').innerHTML = this.screens[screenName](App.state);
                 // Attach specific listeners for checklist screen if it's rendered
                if (screenName === 'petugasVerificationChecklist') {
                    const selectAllCheckbox = document.getElementById('select-all-assets');
                    if (selectAllCheckbox) {
                        selectAllCheckbox.addEventListener('change', (e) => {
                            document.querySelectorAll('.asset-checkbox').forEach(checkbox => {
                                checkbox.checked = e.target.checked;
                            });
                        });
                    }
                }
            },
            attachListeners() {
                const container = document.getElementById('user-page-container');
                container.addEventListener('click', e => {
                    const target = e.target.closest('[data-action]');
                    if (!target) return;
                    e.preventDefault();
                    const action = target.dataset.action;
                    if (this.actions[action]) this.actions[action](target.dataset);
                });
            },
            actions: {
                'select-role': function(dataset) {
                    App.state.activeUserRole = dataset.role;
                    App.user.renderScreen(dataset.role);
                },
                'back-to-role-selection': function() {
                    App.state.activeUserRole = null;
                    App.user.renderScreen('roleSelection');
                },
                'review-item': function(dataset) {
                    App.state.verifikator.currentItem = App.state.verifikator.verificationList.find(i => i.id === dataset.id);
                    App.user.renderScreen('verifikatorDetail');
                },
                'back-to-list': function() { App.user.renderScreen('verifikator'); },
                'approve-item': function() { this.processVerification(true); },
                'reject-item': function() {
                    const reasonContainer = document.getElementById('rejection-reason-container');
                    if (reasonContainer.classList.contains('hidden')) {
                        reasonContainer.classList.remove('hidden');
                    } else {
                        const reasonText = document.getElementById('rejection-reason').value;
                        if (reasonText) { this.processVerification(false, reasonText); }
                        else { alert('Mohon isi alasan penolakan.'); }
                    }
                },
                processVerification(isApproved, reason = '') {
                    const item = App.state.verifikator.currentItem;
                    let message = `Aset ${item.id} telah di-${isApproved ? 'setujui' : `kembalikan untuk penelitian ulang. Alasan: ${reason}`}.`;
                    alert(message);
                    App.state.verifikator.verificationList = App.state.verifikator.verificationList.filter(i => i.id !== item.id);
                    App.user.renderScreen('verifikator');
                },
                'open-worksheet': function(dataset) {
                    App.state.petugas.currentKertasKerjaId = dataset.id;
                    App.user.renderScreen('worksheetDetail');
                },
                'back-to-petugas-dashboard': function() {
                    App.state.petugas.currentKertasKerjaId = null;
                    App.user.renderScreen('petugas');
                },
                'update-asset': function(dataset) {
                    const kk = App.state.petugas.kertasKerja.find(k => k.id === App.state.petugas.currentKertasKerjaId);
                    const asset = kk.assets.find(a => a.id === dataset.id);
                    App.state.petugas.currentAsset = asset;
                    App.user.renderScreen('petugasUpdateAsset');
                },
                'save-update': function() {
                    alert('Data aset berhasil diupdate.');
                    App.user.renderScreen('worksheetDetail');
                },
                 'input-new-asset': function() {
                    App.user.renderScreen('petugasInputNewAsset');
                },
                'save-new-asset': function() {
                     alert('Aset temuan baru berhasil disimpan.');
                     App.user.renderScreen('worksheetDetail');
                },
                'show-verification-checklist': function() {
                    App.user.renderScreen('petugasVerificationChecklist');
                },
                'submit-checked-for-verification': function() {
                    const checkedCount = document.querySelectorAll('.asset-checkbox:checked').length;
                    if (checkedCount > 0) {
                        alert(`${checkedCount} aset berhasil diajukan untuk verifikasi.`);
                        App.user.renderScreen('petugas');
                    } else {
                        alert('Pilih setidaknya satu aset untuk diajukan.');
                    }
                }
            },
            screens: {
                roleSelection: (state) => {
                    const roles = state.currentUser.assigned_roles;
                    const roleCards = roles.map(role => {
                        if(role === 'petugas') {
                            return `<div data-action="select-role" data-role="petugas" class="bg-blue-500 text-white p-8 rounded-lg text-center cursor-pointer hover:bg-blue-600 transition-all">
                                <h2 class="text-2xl font-bold">Petugas Lapangan</h2>
                                <p>Lakukan pendataan aset di lapangan.</p>
                            </div>`;
                        }
                        if(role === 'verifikator') {
                             return `<div data-action="select-role" data-role="verifikator" class="bg-indigo-500 text-white p-8 rounded-lg text-center cursor-pointer hover:bg-indigo-600 transition-all">
                                <h2 class="text-2xl font-bold">Verifikator</h2>
                                <p>Verifikasi data yang diinput oleh petugas.</p>
                            </div>`;
                        }
                        return '';
                    }).join('');
                    // Perubahan: Menghapus max-w-2xl
                    return `
                    <div class="flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4">
                        <div class="text-center mb-10">
                            <h1 class="text-4xl font-bold text-gray-800">Selamat Datang, ${state.currentUser.name}</h1>
                            <p class="text-gray-600 mt-2">Silakan pilih peran Anda untuk kegiatan saat ini.</p>
                        </div>
                        <div class="w-full space-y-6">
                            ${roleCards}
                        </div>
                         <div class="mt-10">
                            <button data-action="logout" class="text-gray-500 hover:underline">Logout</button>
                        </div>
                    </div>`;
                },
                // Perubahan: Menghapus max-w-md dan mx-auto
                petugas: (state) => `<div class="bg-white min-h-screen shadow-2xl"><div class="screen p-6"><header class="mb-8"><div class="flex justify-between items-center"><div><p class="text-gray-500">Selamat datang,</p><h1 class="text-2xl font-bold text-gray-800">${state.currentUser.name}</h1></div><a href="#" data-action="back-to-role-selection" class="text-sm text-blue-600 hover:underline">Ganti Peran &rarr;</a></div></header><h2 class="text-lg font-semibold mb-3">Kertas Kerja Anda</h2><div class="space-y-3">${state.petugas.kertasKerja.map(kk => `<div data-action="open-worksheet" data-id="${kk.id}" class="p-4 border rounded-lg cursor-pointer ${kk.status === 'Perlu Penelitian Ulang' ? 'bg-red-50 border-red-300' : 'bg-gray-50 hover:bg-blue-50'}"><div class="flex justify-between items-center"><p class="font-bold">${kk.batch}</p><span class="text-xs font-medium px-2 py-1 rounded-full ${kk.status === 'Perlu Penelitian Ulang' ? 'bg-red-200 text-red-800' : 'bg-yellow-200 text-yellow-800'}">${kk.status}</span></div><p class="text-sm text-gray-600">Progres: ${kk.progres}/${kk.totalAset} Aset</p>${kk.catatan ? `<p class="text-sm text-red-600 mt-1"><b>Catatan Verifikator:</b> ${kk.catatan}</p>` : ''}</div>`).join('')}</div><div class="mt-10 text-center"><button data-action="logout" class="text-gray-500 hover:underline">Logout</button></div></div></div>`,
                worksheetDetail: (state) => {
                    const kk = state.petugas.kertasKerja.find(k => k.id === state.petugas.currentKertasKerjaId);
                    // Perubahan: Menghapus max-w-md dan mx-auto
                    if (!kk) return `<div class="bg-white min-h-screen shadow-2xl p-6"><a href="#" data-action="back-to-petugas-dashboard" class="text-blue-600">&larr; Kembali</a><p class="text-center text-red-500 mt-8">Kertas Kerja tidak ditemukan.</p></div>`;
                    
                    const assetListHTML = kk.assets.map(asset => {
                        let statusClass = 'bg-gray-100';
                        let statusText = 'Update';
                        let statusTextColor = 'text-white';
                        let buttonBg = 'bg-blue-600';
                        if (asset.status === 'Selesai') {
                            statusClass = 'bg-green-100';
                            statusText = `Selesai ✓`;
                            statusTextColor = 'text-green-700';
                            buttonBg = '';
                        } else if (asset.status === 'Perlu Diperiksa Ulang') {
                            statusClass = 'bg-red-100';
                        }
                        
                        return `<div class="p-3 ${statusClass} rounded-lg flex justify-between items-center">
                            <p>${asset.desc}<br><small class="text-gray-500">Lokasi: ${asset.location}</small></p>
                            ${asset.status !== 'Selesai' ? `<button data-action="update-asset" data-id="${asset.id}" class="${buttonBg} ${statusTextColor} px-3 py-1 rounded-lg text-sm">${statusText}</button>` : `<span class="text-sm font-semibold ${statusTextColor}">${statusText}</span>`}
                        </div>`;
                    }).join('');
                    // Perubahan: Menghapus max-w-md dan mx-auto
                    return `<div class="bg-white min-h-screen shadow-2xl"><div class="screen p-6"><header class="mb-6"><a href="#" data-action="back-to-petugas-dashboard" class="text-blue-600">&larr; Kembali</a><h1 class="text-xl font-bold text-center mt-2">${kk.batch}</h1></header><div class="flex justify-between items-center mb-4"><p class="text-sm">Progres: ${kk.progres}/${kk.totalAset}</p><button data-action="input-new-asset" class="text-sm bg-green-100 text-green-800 px-3 py-1 rounded-full font-semibold">+ Aset Temuan</button></div><div class="space-y-2">${assetListHTML}</div><button data-action="show-verification-checklist" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl text-lg mt-6">Ajukan Verifikasi</button></div></div>`;
                },
                // Perubahan: Menghapus max-w-md dan mx-auto
                petugasInputNewAsset: (state) => `
                <div class="bg-white min-h-screen shadow-2xl">
                    <div class="screen p-6">
                        <header class="mb-6">
                            <a href="#" data-action="open-worksheet" data-id="${state.petugas.currentKertasKerjaId}" class="text-blue-600">&larr; Kembali ke Kertas Kerja</a>
                        </header>
                        <h1 class="text-xl font-bold mb-6">Input Aset Temuan Baru</h1>
                        <form id="new-asset-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Scan ID Tag Baru</label>
                                <div class="mt-1 flex rounded-md shadow-sm">
                                    <input type="text" class="flex-1 block w-full rounded-none rounded-l-md p-2 border border-gray-300" placeholder="Pindai QR Code...">
                                    <button type="button" class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-gray-300 bg-gray-50 text-gray-500">
                                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.875c0-1.036.84-1.875 1.875-1.875h4.5c1.036 0 1.875.84 1.875 1.875v4.5c0 1.036-.84 1.875-1.875 1.875h-4.5A1.875 1.875 0 013.75 9.375v-4.5zM3.75 14.625c0-1.036.84-1.875 1.875-1.875h4.5c1.036 0 1.875.84 1.875 1.875v4.5c0 1.036-.84 1.875-1.875 1.875h-4.5A1.875 1.875 0 013.75 19.125v-4.5zM13.5 4.875c0-1.036.84-1.875 1.875-1.875h4.5c1.036 0 1.875.84 1.875 1.875v4.5c0 1.036-.84 1.875-1.875 1.875h-4.5A1.875 1.875 0 0113.5 9.375v-4.5zM13.5 14.625c0-1.036.84-1.875 1.875-1.875h4.5c1.036 0 1.875.84 1.875 1.875v4.5c0 1.036-.84 1.875-1.875 1.875h-4.5A1.875 1.875 0 0113.5 19.125v-4.5z" /></svg>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Search Material</label>
                                <input type="text" class="w-full mt-1 p-2 border rounded-lg" placeholder="Cari material code atau uraian...">
                                <p class="mt-1 text-xs text-gray-500">Jika tidak ada, isi manual di bawah.</p>
                            </div>
                             <div>
                                <label class="block text-sm font-medium text-gray-700">Foto Aset (bisa lebih dari satu)</label>
                                <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                                    <div class="space-y-1 text-center">
                                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                                        <div class="flex text-sm text-gray-600"><p class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none"><span>Ambil Foto</span></p></div>
                                    </div>
                                </div>
                            </div>
                            <div><label class="block text-sm font-medium text-gray-700">Kondisi</label><select class="w-full mt-1 p-2 border rounded-lg"><option>Baik</option><option>Rusak Ringan</option><option>Rusak Berat</option></select></div>
                            <div><label class="block text-sm font-medium text-gray-700">Klasifikasi</label><select class="w-full mt-1 p-2 border rounded-lg"><option>Metal</option><option>Non Metal</option><option>B3</option></select></div>
                            <div><label class="block text-sm font-medium text-gray-700">Lokasi</label><input type="text" class="w-full mt-1 p-2 border rounded-lg" placeholder="Gudang A / AN-FL-01/C"></div>
                            <div><label class="block text-sm font-medium text-gray-700">Tonase (Opsional - dalam Kg)</label><input type="text" class="w-full mt-1 p-2 border rounded-lg" placeholder="Contoh: 1500"></div>
                            <div><label class="block text-sm font-medium text-gray-700">Dimensi (Opsional)</label><input type="text" class="w-full mt-1 p-2 border rounded-lg" placeholder="Contoh: 100x50x20 cm"></div>
                            <div><label class="block text-sm font-medium text-gray-700">Expired Date (Opsional)</label><input type="date" class="w-full mt-1 p-2 border rounded-lg"></div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Asset Group (Opsional)</label>
                                <select class="w-full mt-1 p-2 border rounded-lg">
                                    <option>1. Process Equipment, and Mechanical System</option>
                                    <option>2. Piping System</option>
                                    <option>3. Instrument and Control System</option>
                                    <option>4. Electrical System</option>
                                    <option>5. Technical Safety System</option>
                                    <option>6. Project Engineering</option>
                                </select>
                            </div>
                             <div><label class="block text-sm font-medium text-gray-700">Keterangan (Opsional)</label><textarea rows="3" class="w-full mt-1 p-2 border rounded-lg" placeholder="Masukkan catatan tambahan..."></textarea></div>
                            <button data-action="save-new-asset" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl mt-6">Simpan Data</button>
                        </form>
                    </div>
                </div>`,
                petugasUpdateAsset: (state) => {
                    const asset = state.petugas.currentAsset;
                    // Perubahan: Menghapus max-w-md dan mx-auto
                    if (!asset) return `<div class="bg-white min-h-screen shadow-2xl p-6"><a href="#" data-action="open-worksheet" data-id="${state.petugas.currentKertasKerjaId}" class="text-blue-600">&larr; Kembali</a><p class="text-center text-red-500 mt-8">Aset tidak ditemukan.</p></div>`;
                    // Perubahan: Menghapus max-w-md dan mx-auto
                    return `<div class="bg-white min-h-screen shadow-2xl">
                    <div class="screen p-6">
                        <header class="mb-6">
                            <a href="#" data-action="open-worksheet" data-id="${state.petugas.currentKertasKerjaId}" class="text-blue-600">&larr; Kembali ke Kertas Kerja</a>
                        </header>
                        <h1 class="text-xl font-bold mb-6">Update Data Aset: ${asset.desc}</h1>
                        <form id="update-asset-form" class="space-y-4">
                             <div>
                                <label class="block text-sm font-medium text-gray-700">Foto Aset (bisa lebih dari satu)</label>
                                <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                                    <div class="space-y-1 text-center">
                                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                                        <div class="flex text-sm text-gray-600"><p class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none"><span>Ambil Foto</span></p></div>
                                    </div>
                                </div>
                            </div>
                            <div><label class="block text-sm font-medium text-gray-700">Kondisi</label><select class="w-full mt-1 p-2 border rounded-lg"><option>Baik</option><option>Rusak Ringan</option><option>Rusak Berat</option></select></div>
                            <div><label class="block text-sm font-medium text-gray-700">Klasifikasi</label><select class="w-full mt-1 p-2 border rounded-lg"><option>Metal</option><option>Non Metal</option><option>B3</option></select></div>
                            <div><label class="block text-sm font-medium text-gray-700">Lokasi</label><input type="text" class="w-full mt-1 p-2 border rounded-lg" value="${asset.location}"></div>
                            <div><label class="block text-sm font-medium text-gray-700">Tonase (Opsional - dalam Kg)</label><input type="text" class="w-full mt-1 p-2 border rounded-lg" placeholder="Contoh: 1500"></div>
                            <div><label class="block text-sm font-medium text-gray-700">Dimensi (Opsional)</label><input type="text" class="w-full mt-1 p-2 border rounded-lg" placeholder="Contoh: 100x50x20 cm"></div>
                            <div><label class="block text-sm font-medium text-gray-700">Expired Date (Opsional)</label><input type="date" class="w-full mt-1 p-2 border rounded-lg"></div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Asset Group (Opsional)</label>
                                <select class="w-full mt-1 p-2 border rounded-lg">
                                    <option>1. Process Equipment, and Mechanical System</option>
                                    <option>2. Piping System</option>
                                    <option>3. Instrument and Control System</option>
                                    <option>4. Electrical System</option>
                                    <option>5. Technical Safety System</option>
                                    <option>6. Project Engineering</option>
                                </select>
                            </div>
                             <div><label class="block text-sm font-medium text-gray-700">Keterangan (Opsional)</label><textarea rows="3" class="w-full mt-1 p-2 border rounded-lg" placeholder="Masukkan catatan tambahan..."></textarea></div>
                            <button data-action="save-update" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl mt-6">Simpan Perubahan</button>
                        </form>
                    </div>
                </div>`;
                },
                petugasVerificationChecklist: (state) => {
                    const kk = state.petugas.kertasKerja.find(k => k.id === state.petugas.currentKertasKerjaId);
                    // Perubahan: Menghapus max-w-md dan mx-auto
                    if (!kk) return `<div class="bg-white min-h-screen shadow-2xl p-6"><a href="#" data-action="back-to-petugas-dashboard" class="text-blue-600">&larr; Kembali</a><p class="text-center text-red-500 mt-8">Kertas Kerja tidak ditemukan.</p></div>`;
                    
                    const assetsToVerify = kk.assets.filter(a => a.status !== 'Belum Diperiksa');
                    const assetListHTML = assetsToVerify.map(asset => `
                        <label for="asset-${asset.id}" class="flex items-center p-3 bg-white rounded-lg border hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" id="asset-${asset.id}" class="asset-checkbox h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="ml-3 text-sm text-gray-700">${asset.desc} <span class="text-gray-500">(${asset.status})</span></span>
                        </label>
                    `).join('');
                    // Perubahan: Menghapus max-w-md dan mx-auto
                    return `<div class="bg-white min-h-screen shadow-2xl"><div class="screen p-6"><header class="mb-6"><a href="#" data-action="open-worksheet" data-id="${state.petugas.currentKertasKerjaId}" class="text-blue-600">&larr; Kembali ke Kertas Kerja</a></header><h1 class="text-xl font-bold mb-4">Ajukan Verifikasi</h1><p class="text-sm text-gray-600 mb-4">Pilih aset yang sudah selesai diperiksa untuk diajukan ke verifikator.</p><div class="space-y-3"><label for="select-all-assets" class="flex items-center p-3 bg-gray-100 rounded-lg border font-semibold cursor-pointer"><input type="checkbox" id="select-all-assets" class="h-5 w-5 rounded"><span class="ml-3">Pilih Semua</span></label>${assetListHTML}</div><button data-action="submit-checked-for-verification" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl mt-6">Ajukan Aset Terpilih</button></div></div>`;
                },
                // Perubahan: Menghapus max-w-6xl dan mx-auto
                verifikator: (state) => `<div class="py-8 px-4"><header class="flex justify-between items-center mb-8"><div><h1 class="text-3xl font-bold text-gray-900">Dashboard Verifikator</h1><p class="text-gray-500">Selamat datang, ${state.currentUser.name}</p></div><div class="flex items-center space-x-4"><a href="#" data-action="back-to-role-selection" class="text-sm text-blue-600 hover:underline">Ganti Peran &rarr;</a><button data-action="logout" class="bg-red-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-red-600">Logout</button></div></header><div class="screen"><div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"><div class="bg-white border p-5 rounded-xl"><h3 class="font-semibold text-gray-500">Menunggu Verifikasi</h3><p class="text-3xl font-bold text-yellow-600">${state.verifikator.verificationList.length}</p></div><div class="bg-white border p-5 rounded-xl"><h3 class="font-semibold text-gray-500">Diverifikasi Hari Ini</h3><p class="text-3xl font-bold text-green-600">25</p></div><div class="bg-white border p-5 rounded-xl"><h3 class="font-semibold text-gray-500">Ditolak Hari Ini</h3><p class="text-3xl font-bold text-red-600">2</p></div></div><div class="bg-white p-6 rounded-xl shadow-md"><h2 class="text-xl font-semibold mb-6">Daftar Aset untuk Diverifikasi</h2><div class="overflow-x-auto"><table class="w-full text-sm text-left"><thead class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th class="px-6 py-3">ID Tag</th><th class="px-6 py-3">Deskripsi</th><th class="px-6 py-3">Batch</th><th class="px-6 py-3">Waktu Input</th><th class="px-6 py-3">Diinput Oleh</th><th class="px-6 py-3">Aksi</th></tr></thead><tbody>${state.verifikator.verificationList.map(item => `<tr><td class="px-6 py-4 font-medium text-gray-900">${item.id}</td><td class="px-6 py-4">${item.desc}</td><td class="px-6 py-4">${item.batch}</td><td class="px-6 py-4">${item.date}</td><td class="px-6 py-4">${item.submittedBy}</td><td class="px-6 py-4"><button data-action="review-item" data-id="${item.id}" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold">Periksa</button></td></tr>`).join('')}</tbody></table></div></div></div></div>`,
                verifikatorDetail: (state) => {
                    const item = state.verifikator.currentItem;
                    if (!item) return `<div>Error: Item tidak ditemukan.</div>`;

                    const renderDetail = (label, value) => {
                        if (!value) return '';
                        return `<div class="py-2 sm:grid sm:grid-cols-3 sm:gap-4"><dt class="text-sm font-medium text-gray-500">${label}</dt><dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">${value}</dd></div>`;
                    };
                    
                    const renderLokasiLama = (lokasi) => {
                        if(!lokasi) return '<li>Tidak ada data</li>';
                        return Object.entries(lokasi).map(([nama, jumlah]) => `<li>${nama}: <strong>${jumlah}</strong></li>`).join('');
                    };
                    // Perubahan: Menghapus max-w-6xl dan mx-auto
                    return `<div class="py-8 px-4">
                        <div class="mb-6"><a href="#" data-action="back-to-list" class="text-blue-600">&larr; Kembali ke Daftar</a></div>
                        <div class="bg-white p-8 rounded-xl shadow-md">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h2 class="text-2xl font-bold mb-1">Detail Verifikasi Aset</h2>
                                    <p class="text-gray-500">ID Tag: ${item.id}</p>
                                </div>
                                <span class="text-sm font-medium px-3 py-1 rounded-full bg-yellow-100 text-yellow-800">${item.status}</span>
                            </div>
                            
                            <div class="grid lg:grid-cols-5 gap-8 mt-6">
                                <div class="lg:col-span-3">
                                    <h3 class="text-lg font-semibold mb-4 border-b pb-2">Data Baru (Hasil Inventarisasi)</h3>
                                    <dl class="divide-y divide-gray-200">
                                        ${renderDetail('Material Code', item.materialCode || '-')}
                                        ${renderDetail('Uraian', item.desc)}
                                        ${renderDetail('Klasifikasi', item.details.klasifikasi)}
                                        ${renderDetail('Kondisi', item.details.kondisi)}
                                        ${renderDetail('Lokasi Baru', item.details.lokasi)}
                                        ${renderDetail('Tonase', item.details.tonase ? `${item.details.tonase} kg` : '-')}
                                        ${renderDetail('Dimensi', item.details.dimensi || '-')}
                                        ${renderDetail('Expired Date', item.details.expiredDate || '-')}
                                        ${renderDetail('Asset Group', item.details.assetGroup || '-')}
                                        ${renderDetail('Keterangan', item.details.keterangan || '-')}
                                    </dl>

                                    <h3 class="text-lg font-semibold mt-6 mb-4 border-b pb-2">Data Lama (Master)</h3>
                                    ${item.previousData ? `
                                    <dl class="divide-y divide-gray-200">
                                        <div class="py-2 sm:grid sm:grid-cols-3 sm:gap-4">
                                            <dt class="text-sm font-medium text-gray-500">Qty Total</dt>
                                            <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">${item.previousData.qtyTotal}</dd>
                                        </div>
                                        <div class="py-2 sm:grid sm:grid-cols-3 sm:gap-4">
                                            <dt class="text-sm font-medium text-gray-500">Jumlah per Lokasi</dt>
                                            <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                                                <ul class="list-disc pl-5">${renderLokasiLama(item.previousData.lokasi)}</ul>
                                            </dd>
                                        </div>
                                    </dl>
                                    ` : `<div class="bg-blue-50 text-blue-700 p-4 rounded-lg text-sm">Aset ini merupakan temuan baru dan tidak ada pada data lama.</div>`}
                                </div>
                                <div class="lg:col-span-2">
                                     <h3 class="text-lg font-semibold mb-4 border-b pb-2">Foto Aset</h3>
                                     <div class="space-y-4">
                                        ${item.photos.map(p => `<img src="${p}" alt="Foto Aset" class="w-full rounded-lg shadow-md">`).join('')}
                                     </div>
                                      <div class="pt-6 mt-6 border-t">
                                        <h3 class="text-lg font-semibold mb-3">Tindakan</h3>
                                        <div id="rejection-reason-container" class="hidden mb-4">
                                            <label for="rejection-reason" class="block text-sm font-medium mb-1">Alasan Penolakan (untuk Penelitian Ulang)</label>
                                            <textarea id="rejection-reason" rows="3" class="w-full p-2 border rounded-lg" placeholder="Contoh: Foto tidak jelas, harap ambil ulang."></textarea>
                                        </div>
                                        <div class="flex space-x-4"><button data-action="approve-item" class="flex-1 bg-green-600 text-white font-bold py-3 rounded-lg">Setujui</button><button data-action="reject-item" class="flex-1 bg-red-600 text-white font-bold py-3 rounded-lg">Tolak (Penelitian Ulang)</button></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>`;
                }
            }
        }
    };

    document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
